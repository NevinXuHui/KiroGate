#!/bin/bash
# KiroGate é€šç”¨å¯åŠ¨å™¨ - è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿå¹¶é€‰æ‹©åˆé€‚çš„è„šæœ¬
# Universal launcher for KiroGate - Auto-detects system and runs appropriate script

set -e

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
detect_os() {
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        echo "linux"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        echo "macos"
    elif [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "win32" ]]; then
        echo "windows"
    else
        echo "unknown"
    fi
}

# æ£€æµ‹å¯ç”¨çš„ shell
detect_shell() {
    if command -v pwsh &> /dev/null; then
        echo "powershell"
    elif command -v bash &> /dev/null; then
        echo "bash"
    else
        echo "none"
    fi
}

OS=$(detect_os)
SHELL_TYPE=$(detect_shell)

echo "ğŸ” æ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿ: $OS"
echo "ğŸš å¯ç”¨ Shell: $SHELL_TYPE"
echo ""

# æ ¹æ®ç³»ç»Ÿé€‰æ‹©åˆé€‚çš„è„šæœ¬
case "$OS" in
    linux|macos)
        if [ -f "run.sh" ]; then
            echo "âœ… ä½¿ç”¨ run.sh å¯åŠ¨..."
            chmod +x run.sh 2>/dev/null || true
            exec ./run.sh "$@"
        else
            echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° run.sh"
            exit 1
        fi
        ;;
    windows)
        if [ -f "run.sh" ]; then
            echo "âœ… ä½¿ç”¨ run.sh å¯åŠ¨ (Git Bash)..."
            chmod +x run.sh 2>/dev/null || true
            exec ./run.sh "$@"
        elif command -v cmd.exe &> /dev/null && [ -f "run.bat" ]; then
            echo "âœ… ä½¿ç”¨ run.bat å¯åŠ¨..."
            cmd.exe /c "run.bat $*"
        else
            echo "âŒ é”™è¯¯: æœªæ‰¾åˆ°åˆé€‚çš„å¯åŠ¨è„šæœ¬"
            exit 1
        fi
        ;;
    *)
        echo "âŒ é”™è¯¯: ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ"
        exit 1
        ;;
esac
